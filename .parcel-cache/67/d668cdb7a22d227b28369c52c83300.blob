"use strict";

var helpers = require("../node_modules/@parcel/transformer-react-refresh-wrap/lib/helpers/helpers.js");

var prevRefreshReg = window.$RefreshReg$;
var prevRefreshSig = window.$RefreshSig$;
helpers.prelude(module);

try {
  Object.defineProperty(exports, "__esModule", {
    value: true
  });
  exports.default = void 0;

  var _react = _interopRequireDefault(require("react"));

  var _reactstrap = require("reactstrap");

  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

  const MODEL = 'comentarios';
  const API_URL = "http://localhost:3000/api/" + MODEL;
  const USER_URL = "http://localhost:3000/api/usuarios/";
  const HEADERS = new Headers({
    'Accept': 'application/json',
    'Content-Type': 'application/json'
  });

  class Comentario extends _react.default.Component {
    constructor(props) {
      super(props);
      this.state = {
        comentario: '',
        idUsuario: 0,
        usuario: '',
        idDistrito: 0,
        lista: []
      };
      this.Guardar = this.Guardar.bind(this);
      this.cargaDatos = this.cargaDatos.bind(this);
      this.cargaUsuario = this.cargaUsuario.bind(this);
      this.handleChange = this.handleChange.bind(this);
      this.getNamefromID = this.getNamefromID.bind(this); //this.Borrar = this.Borrar.bind(this);
    }
    /*componentDidMount() {
        this.cargaDatos();
    }*/


    cargaUsuario() {
      if (this.props.idUsuario != 0) {
        const opcions = {
          method: "GET",
          headers: HEADERS
        };
        fetch(USER_URL + this.props.idUsuario, opcions).then(texto => texto.json()).then(datos => this.setState({
          idUsuario: this.props.idUsuario,
          usuario: datos[0].nombre
        })).then(console.log(this.state.usuario)).catch(error => console.log("se ha producido un error: ", error));
      } else {
        this.setState({
          idUsuario: 0,
          usuario: ''
        });
      }
    }

    cargaDatos() {
      const opcions = {
        method: "GET",
        headers: HEADERS
      };
      fetch(API_URL + "?_where=(distritos_iddistritos,eq," + this.props.idDistrito + ")", opcions).then(texto => texto.json()).then(datos => this.setState({
        lista: datos,
        idDistrito: this.props.idDistrito
      })).catch(error => console.log("se ha producido un error: ", error));
    }

    Guardar() {
      const comentario = {
        texto: this.state.comentario,
        distritos_iddistritos: this.props.idDistrito,
        usuarios_idusuarios: this.props.idUsuario
      };
      console.log(comentario);
      const opcions = {
        method: "POST",
        headers: HEADERS,
        body: JSON.stringify(comentario)
      };
      fetch(API_URL, opcions) // .then(respuesta => respuesta.json())
      // .then(ddd => console.log(ddd))
      .then(() => this.cargaDatos()).then(() => this.setState({
        comentario: ''
      })).catch(error => console.log("se ha producido un error: ", error));
    }

    handleChange(event) {
      const value = event.target.value;
      const name = event.target.name;
      this.setState({
        [name]: value
      });
    }
    /*Borrar(idcomentarios) {
        console.log("borrando " + idcomentarios);
        const opcions = {
            method: "DELETE",
            headers: HEADERS
        };
          const deleteURL = API_URL + '/' + idcomentarios;
          fetch(deleteURL, opcions)
            .then(respuesta => respuesta.json())
            .then(ddd => console.log(ddd))
            .then(() => this.cargaDatos())
            .catch(error => console.log("se ha producido un error: ", error));
        }*/


    getNamefromID(comentario) {
      let userName;
      const opcions = {
        method: "GET",
        headers: HEADERS
      };
      fetch(USER_URL + comentario.usuarios_idusuarios, opcions).then(texto => texto.json()).then(userObj => userName = userObj[0].nombre).then(nombreUsuario => {
        console.log(nombreUsuario);
        return nombreUsuario;
      }).catch(error => console.log("se ha producido un error: ", error));
    }

    render() {
      if (this.state.idDistrito != this.props.idDistrito) {
        this.cargaDatos();
      }

      if (this.state.idUsuario != this.props.idUsuario) {
        this.cargaUsuario();
      }
      /* if (this.state.lista.length === 0) {
          console.log("cargando coments")
          return <h3>Loading comments</h3>
      } */


      const listaComentarios = this.state.lista.map((el, i) => /*#__PURE__*/_react.default.createElement("div", {
        style: {
          marginTop: "20px"
        },
        key: i
      }, /*#__PURE__*/_react.default.createElement("span", null, /*#__PURE__*/_react.default.createElement("span", {
        style: {
          fontWeight: "bold"
        }
      }, this.getNamefromID(el).then(response => response)), /*#__PURE__*/_react.default.createElement("br", null), el.texto)));
      return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, this.state.lista.length === 0 ? /*#__PURE__*/_react.default.createElement("h5", null, "Se el primero en comentar!") : listaComentarios, /*#__PURE__*/_react.default.createElement("br", null), this.state.idUsuario > 0 ? /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("h3", null, "Guarda tu comentario"), /*#__PURE__*/_react.default.createElement("div", {
        className: "inputs"
      }, /*#__PURE__*/_react.default.createElement(_reactstrap.Label, {
        for: "ComentInput"
      }, "Comentario"), /*#__PURE__*/_react.default.createElement(_reactstrap.Input, {
        type: "text",
        name: "comentario",
        value: this.state.comentario,
        onChange: this.handleChange
      }), /*#__PURE__*/_react.default.createElement("br", null), /*#__PURE__*/_react.default.createElement(_reactstrap.Button, {
        onClick: this.Guardar
      }, "Sube tu comentario")), " ") : /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null));
    }

  }

  var _default = Comentario;
  exports.default = _default;
  helpers.postlude(module);
} finally {
  window.$RefreshReg$ = prevRefreshReg;
  window.$RefreshSig$ = prevRefreshSig;
}